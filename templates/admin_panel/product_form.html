{% extends 'admin_panel/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ title }}</h1>
</div>

<div class="card">
    <div class="card-body">
        <form method="post" enctype="multipart/form-data" id="productForm">
            {% csrf_token %}
            
            <h5 class="mb-3">Informations de base</h5>
            <div class="row g-3">
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.reference.id_for_label }}" class="form-label">
                        <i class="bi bi-upc"></i> R√©f√©rence *
                    </label>
                    {{ form.reference }}
                </div>
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.name.id_for_label }}" class="form-label">
                        <i class="bi bi-tag"></i> Nom du produit *
                    </label>
                    {{ form.name }}
                </div>
            </div>

            <h5 class="mb-3 mt-4">üì∏ Images du produit</h5>
            <div class="alert alert-info alert-permanent py-2 mb-3">
                <small>
                    <i class="bi bi-aspect-ratio"></i> <strong>Dimension recommand√©e:</strong> 600 x 600 px (carr√© 1:1)<br>
                    <i class="bi bi-file-image"></i> <strong>Format:</strong> WebP ou JPG recommand√© (PNG, GIF aussi accept√©s) | <strong>Taille max:</strong> 100 KB<br>
                    <i class="bi bi-palette"></i> <strong>Conseil:</strong> Fond blanc pr√©f√©r√© pour un meilleur rendu
                </small>
            </div>
            
            {% if product %}
            <!-- Images existantes -->
            <div class="mb-4">
                <label class="form-label fw-bold">Images actuelles</label>
                <div class="row g-3" id="existingImages">
                    {% for image in product.images.all %}
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="card h-100 shadow-sm">
                            <div class="position-relative">
                                <img src="{{ image.image.url }}" class="card-img-top" 
                                     style="height: 120px; object-fit: cover; cursor: pointer;"
                                     onclick="viewFullImage('{{ image.image.url }}')"
                                     alt="Image produit">
                                {% if image.is_main %}
                                <span class="position-absolute top-0 start-0 badge bg-success m-1">
                                    <i class="bi bi-star-fill"></i> Principale
                                </span>
                                {% endif %}
                            </div>
                            <div class="card-body p-2">
                                <div class="form-check mb-1">
                                    <input class="form-check-input existing-main-radio" type="radio" 
                                           name="existing_main_image" value="{{ image.id }}"
                                           id="existing_main_{{ image.id }}"
                                           {% if image.is_main %}checked{% endif %}>
                                    <label class="form-check-label small" for="existing_main_{{ image.id }}">
                                        Principale
                                    </label>
                                </div>
                                <button type="button" class="btn btn-sm btn-danger w-100 mt-1" 
                                        onclick="deleteImage({{ image.id }})">
                                    <i class="bi bi-trash"></i> Supprimer
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Nouvelles images -->
            <div class="mb-3">
                <label for="product_images" class="form-label fw-bold">
                    {% if product %}‚ûï Ajouter de nouvelles images{% else %}üì∑ Ajouter des images *{% endif %}
                </label>
                <input type="file" class="form-control form-control-lg" id="product_images" 
                       name="product_images" multiple accept="image/*" 
                       onchange="previewImages(event)">
                <div class="form-text">
                    <i class="bi bi-info-circle"></i> S√©lectionnez plusieurs images (Ctrl+Clic). 
                    La premi√®re sera l'image principale par d√©faut.
                </div>
            </div>

            <!-- Pr√©visualisation des nouvelles images -->
            <div id="imagePreview" class="row g-3 mb-3"></div>

            <h5 class="mb-3 mt-4">SEO</h5>
            <div class="mb-3">
                <label for="{{ form.meta_title.id_for_label }}" class="form-label">Meta Titre</label>
                {{ form.meta_title }}
            </div>
            <div class="mb-3">
                <label for="{{ form.meta_description.id_for_label }}" class="form-label">Meta Description</label>
                {{ form.meta_description }}
            </div>

            <h5 class="mb-3 mt-4">Description</h5>
            <div class="mb-3">
                <label for="{{ form.description.id_for_label }}" class="form-label">Description *</label>
                {{ form.description }}
            </div>
            
            <h5 class="mb-3 mt-4">üîß Caract√©ristiques techniques</h5>
            <p class="text-muted small mb-3">
                <i class="bi bi-lightbulb"></i> Ajoutez les sp√©cifications de votre produit ligne par ligne
            </p>
            <div id="specifications-container" class="mb-3">
                {% if product %}
                    {% for spec in product.specifications.all %}
                    <div class="row g-2 mb-2 spec-row">
                        <div class="col-12 col-md-5">
                            <input type="text" name="spec_key[]" class="form-control" 
                                   placeholder="Caract√©ristique (ex: Processeur)" 
                                   value="{{ spec.key }}">
                        </div>
                        <div class="col-10 col-md-5">
                            <input type="text" name="spec_value[]" class="form-control" 
                                   placeholder="Valeur (ex: Intel Core i7)" 
                                   value="{{ spec.value }}">
                        </div>
                        <div class="col-2 col-md-2">
                            <button type="button" class="btn btn-danger w-100" onclick="removeSpec(this)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
                
                <!-- Template initial si pas de specs existantes -->
                {% if not product or product.specifications.count == 0 %}
                <div class="row g-2 mb-2 spec-row">
                    <div class="col-12 col-md-5">
                        <input type="text" name="spec_key[]" class="form-control" 
                               placeholder="Caract√©ristique (ex: Processeur)">
                    </div>
                    <div class="col-10 col-md-5">
                        <input type="text" name="spec_value[]" class="form-control" 
                               placeholder="Valeur (ex: Intel Core i7)">
                    </div>
                    <div class="col-2 col-md-2">
                        <button type="button" class="btn btn-danger w-100" onclick="removeSpec(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm mb-3" onclick="addSpec()">
                <i class="bi bi-plus-circle"></i> Ajouter une caract√©ristique
            </button>
            
            <div class="mb-3">
                <label for="{{ form.caracteristiques.id_for_label }}" class="form-label">
                    üìù Autres informations (optionnel)
                </label>
                {{ form.caracteristiques }}
                <div class="form-text">Zone de texte libre pour informations suppl√©mentaires</div>
            </div>

            <h5 class="mb-3 mt-4">üè∑Ô∏è Classification</h5>
            <div class="row g-3">
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.category.id_for_label }}" class="form-label">Cat√©gorie *</label>
                    {{ form.category }}
                </div>
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.subcategory.id_for_label }}" class="form-label">Sous-cat√©gorie *</label>
                    {{ form.subcategory }}
                </div>
            </div>
            <div class="row g-3">
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.brand.id_for_label }}" class="form-label">
                        <i class="bi bi-building"></i> Marque
                    </label>
                    {{ form.brand }}
                </div>
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.type.id_for_label }}" class="form-label">
                        <i class="bi bi-tag"></i> Mod√®le
                    </label>
                    {{ form.type }}
                    <div class="form-text">
                        <i class="bi bi-info-circle"></i> S√©lectionnez d'abord une marque
                    </div>
                </div>
            </div>
            <div class="row g-3">
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.collection.id_for_label }}" class="form-label">Collection</label>
                    {{ form.collection }}
                </div>
            </div>

            <h5 class="mb-3 mt-4">üí∞ Prix et Stock</h5>
            <div class="row g-3">
                <div class="col-12 col-sm-6 col-lg-4 mb-3">
                    <label for="{{ form.price.id_for_label }}" class="form-label">
                        <i class="bi bi-currency-dollar"></i> Prix *
                    </label>
                    {{ form.price }}
                </div>
                <div class="col-12 col-sm-6 col-lg-4 mb-3">
                    <label for="{{ form.discount_price.id_for_label }}" class="form-label">
                        <i class="bi bi-tag-fill"></i> Prix Promo
                    </label>
                    {{ form.discount_price }}
                </div>
                <div class="col-12 col-sm-6 col-lg-4 mb-3">
                    <label for="{{ form.quantity.id_for_label }}" class="form-label">
                        <i class="bi bi-box-seam"></i> Quantit√© *
                    </label>
                    {{ form.quantity }}
                </div>
            </div>
            <div class="row g-3">
                <div class="col-12 col-md-6 mb-3">
                    <label for="{{ form.status.id_for_label }}" class="form-label">Statut</label>
                    {{ form.status }}
                </div>
            </div>

            <h5 class="mb-3 mt-4">‚≠ê Caract√©ristiques sp√©ciales</h5>
            <div class="row g-3">
                <div class="col-12 col-sm-6 col-md-4">
                    <div class="card border-primary h-100">
                        <div class="card-body">
                            <div class="form-check">
                                {{ form.is_bestseller }}
                                <label class="form-check-label" for="{{ form.is_bestseller.id_for_label }}">
                                    <i class="bi bi-star-fill text-warning"></i> <strong>Best Seller</strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4">
                    <div class="card border-success h-100">
                        <div class="card-body">
                            <div class="form-check">
                                {{ form.is_featured }}
                                <label class="form-check-label" for="{{ form.is_featured.id_for_label }}">
                                    <i class="bi bi-award-fill text-success"></i> <strong>En vedette</strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4">
                    <div class="card border-info h-100">
                        <div class="card-body">
                            <div class="form-check">
                                {{ form.is_new }}
                                <label class="form-check-label" for="{{ form.is_new.id_for_label }}">
                                    <i class="bi bi-lightning-fill text-info"></i> <strong>Nouveau</strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h5 class="mb-3 mt-4">‚ÑπÔ∏è Autres informations</h5>
            <div class="row g-3">
                <div class="col-12 col-sm-6 col-lg-4 mb-3">
                    <label for="{{ form.brand_text.id_for_label }}" class="form-label">
                        <i class="bi bi-text-left"></i> Marque (texte - deprecated)
                    </label>
                    {{ form.brand_text }}
                    <div class="form-text text-muted small">Utiliser le s√©lecteur de marque ci-dessus</div>
                </div>
                <div class="col-12 col-sm-6 col-lg-4 mb-3">
                    <label for="{{ form.warranty.id_for_label }}" class="form-label">
                        <i class="bi bi-shield-check"></i> Garantie
                    </label>
                    {{ form.warranty }}
                </div>
                <div class="col-12 col-sm-6 col-lg-4 mb-3">
                    <label for="{{ form.weight.id_for_label }}" class="form-label">
                        <i class="bi bi-box"></i> Poids (kg)
                    </label>
                    {{ form.weight }}
                </div>
            </div>

            <div class="mt-4 d-flex flex-column flex-sm-row gap-2">
                <button type="submit" class="btn btn-primary btn-lg flex-grow-1">
                    <i class="bi bi-save"></i> Enregistrer
                </button>
                <a href="{% url 'admin_panel:product_list' %}" class="btn btn-secondary btn-lg flex-grow-1">
                    <i class="bi bi-x-circle"></i> Annuler
                </a>
            </div>
        </form>
    </div>
</div>

<script>
let selectedMainIndex = 0;

// ============ GESTION DES IMAGES ============
function previewImages(event) {
    const preview = document.getElementById('imagePreview');
    preview.innerHTML = '';
    const files = event.target.files;
    
    if (files.length === 0) return;
    
    // Message de chargement
    preview.innerHTML = '<div class="col-12"><div class="alert alert-info"><i class="bi bi-hourglass-split"></i> Chargement des images...</div></div>';
    
    let loadedCount = 0;
    
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            loadedCount++;
            
            if (loadedCount === 1) {
                preview.innerHTML = '';
            }
            
            const col = document.createElement('div');
            col.className = 'col-6 col-md-4 col-lg-3';
            
            const isFirst = i === 0;
            const imageNumber = i + 1;
            const fileSizeKB = (file.size / 1024).toFixed(1);
            
            col.innerHTML = `
                <div class="card shadow-sm h-100 ${isFirst ? 'border-success border-2' : ''}">
                    <div class="position-relative">
                        <img src="${e.target.result}" class="card-img-top" 
                             style="height: 120px; object-fit: cover; cursor: pointer;"
                             onclick="viewFullImage('${e.target.result}')"
                             alt="Pr√©visualisation ${imageNumber}">
                        ${isFirst ? '<span class="position-absolute top-0 start-0 badge bg-success m-1"><i class="bi bi-star-fill"></i> D√©faut</span>' : ''}
                    </div>
                    <div class="card-body p-2">
                        <div class="form-check mb-1">
                            <input class="form-check-input main-image-radio" type="radio" 
                                   name="main_image_select" value="${i}" 
                                   id="main_${i}" ${isFirst ? 'checked' : ''} 
                                   onchange="selectMainImage(${i})">
                            <label class="form-check-label small fw-bold" for="main_${i}">
                                Principale
                            </label>
                        </div>
                        <small class="text-muted d-block">
                            <i class="bi bi-image"></i> ${fileSizeKB} KB
                        </small>
                    </div>
                </div>
            `;
            preview.appendChild(col);
        };
        
        reader.readAsDataURL(file);
    }
    
    {% if product %}
    document.querySelectorAll('.existing-main-radio').forEach(radio => {
        radio.checked = false;
    });
    {% endif %}
}

function selectMainImage(index) {
    selectedMainIndex = index;
    
    // Mettre √† jour visuellement
    document.querySelectorAll('#imagePreview .card').forEach(card => {
        card.classList.remove('border-success', 'border-2');
    });
    
    document.querySelectorAll('#imagePreview .badge').forEach(badge => {
        if (badge.textContent.includes('D√©faut')) badge.remove();
    });
    
    const selectedCard = document.querySelector(`#main_${index}`).closest('.card');
    if (selectedCard) {
        selectedCard.classList.add('border-success', 'border-2');
        const badge = document.createElement('span');
        badge.className = 'position-absolute top-0 start-0 badge bg-success m-1';
        badge.innerHTML = '<i class="bi bi-star-fill"></i> Principale';
        selectedCard.querySelector('.position-relative').appendChild(badge);
    }
    
    let hiddenInput = document.getElementById('main_image_index');
    if (!hiddenInput) {
        hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'main_image_index';
        hiddenInput.id = 'main_image_index';
        document.getElementById('productForm').appendChild(hiddenInput);
    }
    hiddenInput.value = index;
}

function viewFullImage(src) {
    const modal = document.createElement('div');
    modal.className = 'modal-fullscreen-image';
    modal.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:9999; display:flex; align-items:center; justify-content:center; cursor:pointer; padding:20px;';
    
    const img = document.createElement('img');
    img.src = src;
    img.style.cssText = 'max-width:100%; max-height:100%; object-fit:contain;';
    
    const closeBtn = document.createElement('button');
    closeBtn.className = 'btn btn-light position-absolute top-0 end-0 m-3';
    closeBtn.innerHTML = '<i class="bi bi-x-lg"></i> Fermer';
    closeBtn.onclick = (e) => { e.stopPropagation(); modal.remove(); };
    
    modal.appendChild(img);
    modal.appendChild(closeBtn);
    modal.onclick = () => modal.remove();
    
    document.body.appendChild(modal);
}

function deleteImage(imageId) {
    if (!confirm('‚ö†Ô∏è Voulez-vous vraiment supprimer cette image ?')) return;
    
    const btn = event.target.closest('button');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Suppression...';
    
    fetch(`/admin-panel/product/image/${imageId}/delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('‚ùå Erreur: ' + (data.error || 'Erreur inconnue'));
            btn.disabled = false;
            btn.innerHTML = '<i class="bi bi-trash"></i> Supprimer';
        }
    })
    .catch(error => {
        alert('‚ùå Erreur r√©seau: ' + error);
        btn.disabled = false;
        btn.innerHTML = '<i class="bi bi-trash"></i> Supprimer';
    });
}

// ============ GESTION DES CARACT√âRISTIQUES ============
function addSpec() {
    const container = document.getElementById('specifications-container');
    const newRow = document.createElement('div');
    newRow.className = 'row g-2 mb-2 spec-row';
    newRow.innerHTML = `
        <div class="col-12 col-md-5">
            <input type="text" name="spec_key[]" class="form-control" 
                   placeholder="Caract√©ristique (ex: Processeur)">
        </div>
        <div class="col-10 col-md-5">
            <input type="text" name="spec_value[]" class="form-control" 
                   placeholder="Valeur (ex: Intel Core i7)">
        </div>
        <div class="col-2 col-md-2">
            <button type="button" class="btn btn-danger w-100" onclick="removeSpec(this)">
                <i class="bi bi-trash"></i>
            </button>
        </div>
    `;
    container.appendChild(newRow);
    
    // Animation d'entr√©e
    newRow.style.opacity = '0';
    setTimeout(() => {
        newRow.style.transition = 'opacity 0.3s';
        newRow.style.opacity = '1';
    }, 10);
}

function removeSpec(button) {
    const row = button.closest('.spec-row');
    const container = document.getElementById('specifications-container');
    
    if (container.querySelectorAll('.spec-row').length > 1) {
        row.style.transition = 'opacity 0.3s';
        row.style.opacity = '0';
        setTimeout(() => row.remove(), 300);
    } else {
        row.querySelectorAll('input').forEach(input => input.value = '');
    }
}

// ============ FILTRAGE DYNAMIQUE - CHARGEMENT VIA AJAX ============
(function() {
    // R√©cup√©rer les √©l√©ments du formulaire
    const categorySelect = document.getElementById('{{ form.category.id_for_label }}');
    const subcategorySelect = document.getElementById('{{ form.subcategory.id_for_label }}');
    const brandSelect = document.getElementById('{{ form.brand.id_for_label }}');
    const typeSelect = document.getElementById('{{ form.type.id_for_label }}');
    
    // Sauvegarder les valeurs initiales pour l'√©dition
    const initialSubcategory = subcategorySelect ? subcategorySelect.value : '';
    const initialType = typeSelect ? typeSelect.value : '';
    
    // Vider les dropdowns au d√©part (sauf si en mode √©dition avec valeurs)
    {% if not product %}
    if (subcategorySelect) {
        subcategorySelect.innerHTML = '<option value="">S√©lectionnez d\'abord une cat√©gorie</option>';
        subcategorySelect.disabled = true;
    }
    if (typeSelect) {
        typeSelect.innerHTML = '<option value="">S√©lectionnez d\'abord une marque</option>';
        typeSelect.disabled = true;
    }
    {% endif %}
    
    // Function to load subcategories via AJAX
    function loadSubcategories(categoryId, selectedValue = '') {
        if (!subcategorySelect) return;
        
        if (!categoryId) {
            subcategorySelect.innerHTML = '<option value="">S√©lectionnez d\'abord une cat√©gorie</option>';
            subcategorySelect.disabled = true;
            loadTypes('', '', ''); // Clear types too
            return;
        }
        
        // Show loading state
        subcategorySelect.innerHTML = '<option value="">Chargement...</option>';
        subcategorySelect.disabled = true;
        
        // Fetch subcategories for this category
        fetch(`/admin-panel/ajax/subcategories-by-category/?category_id=${categoryId}`)
            .then(response => response.json())
            .then(data => {
                subcategorySelect.innerHTML = '<option value="">---------</option>';
                
                data.forEach(sub => {
                    const opt = new Option(sub.name, sub.id);
                    subcategorySelect.add(opt);
                });
                
                subcategorySelect.disabled = false;
                
                // Restore selection if provided
                if (selectedValue && data.some(s => s.id == selectedValue)) {
                    subcategorySelect.value = selectedValue;
                }
                
                // Reload types after subcategory change
                loadTypes(subcategorySelect.value, brandSelect ? brandSelect.value : '', '');
            })
            .catch(error => {
                console.error('Erreur lors du chargement des sous-cat√©gories:', error);
                subcategorySelect.innerHTML = '<option value="">Erreur de chargement</option>';
            });
    }
    
    // Function to load types via AJAX (filtered by subcategory AND/OR brand)
    function loadTypes(subcategoryId, brandId, selectedValue = '') {
        if (!typeSelect) return;
        
        if (!subcategoryId && !brandId) {
            typeSelect.innerHTML = '<option value="">S√©lectionnez une marque ou sous-cat√©gorie</option>';
            typeSelect.disabled = true;
            return;
        }
        
        // Show loading state
        typeSelect.innerHTML = '<option value="">Chargement...</option>';
        typeSelect.disabled = true;
        
        // Build query parameters
        let url = '/admin-panel/ajax/types-filtered/?';
        if (subcategoryId) url += `subcategory_id=${subcategoryId}&`;
        if (brandId) url += `brand_id=${brandId}`;
        
        // Fetch types
        fetch(url)
            .then(response => response.json())
            .then(data => {
                typeSelect.innerHTML = '<option value="">---------</option>';
                
                data.forEach(type => {
                    const opt = new Option(type.name, type.id);
                    typeSelect.add(opt);
                });
                
                typeSelect.disabled = false;
                
                // Restore selection if provided
                if (selectedValue && data.some(t => t.id == selectedValue)) {
                    typeSelect.value = selectedValue;
                }
            })
            .catch(error => {
                console.error('Erreur lors du chargement des types:', error);
                typeSelect.innerHTML = '<option value="">Erreur de chargement</option>';
            });
    }
    
    // Event listeners
    if (categorySelect) {
        categorySelect.addEventListener('change', function() {
            loadSubcategories(this.value, '');
        });
    }
    
    if (subcategorySelect) {
        subcategorySelect.addEventListener('change', function() {
            loadTypes(this.value, brandSelect ? brandSelect.value : '', '');
        });
    }
    
    if (brandSelect) {
        brandSelect.addEventListener('change', function() {
            loadTypes(subcategorySelect ? subcategorySelect.value : '', this.value, '');
        });
    }
    
    // Initialize for edit mode
    {% if product %}
    if (categorySelect && categorySelect.value) {
        loadSubcategories(categorySelect.value, initialSubcategory);
    }
    if ((subcategorySelect && subcategorySelect.value) || (brandSelect && brandSelect.value)) {
        setTimeout(() => {
            loadTypes(
                subcategorySelect ? subcategorySelect.value : '',
                brandSelect ? brandSelect.value : '',
                initialType
            );
        }, 500);
    }
    {% endif %}
})();

// ============ VALIDATION ============
document.addEventListener('DOMContentLoaded', function() {
    selectMainImage(0);
    
    const form = document.getElementById('productForm');
    
    // Validation avant soumission
    form.addEventListener('submit', function(e) {
        const images = document.querySelectorAll('#imagePreview .card, #existingImages .card');
        
        {% if not product %}
        if (images.length === 0) {
            e.preventDefault();
            alert('‚ö†Ô∏è Veuillez ajouter au moins une image au produit');
            document.getElementById('product_images').focus();
            return false;
        }
        {% endif %}
        
        // Afficher un indicateur de chargement
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Enregistrement...';
    });
});
</script>

<style>
/* Responsive improvements */
@media (max-width: 576px) {
    .card-body {
        font-size: 0.875rem;
    }
    
    .btn-sm {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    
    h5 {
        font-size: 1.1rem;
    }
}

/* Animation pour les cartes */
.card {
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* Am√©lioration des checkbox */
.form-check-input:checked {
    background-color: #198754;
    border-color: #198754;
}

/* Badge responsive */
.badge {
    font-size: 0.7rem;
}

@media (max-width: 768px) {
    .badge {
        font-size: 0.65rem;
    }
}
</style>
{% endblock %}
